<!DOCTYPE html>
<html>

<head>
    <title>時計</title>
    <style>
        div {
            margin: auto;
            height: max-content;
            text-align: center;
            font-size: 2rem;
        }
    </style>

</head>

<body>
    <div id="countup"></div>
    <div id="countdown"></div>
    <script defer>
        function tokeiLoop() {
            const start = new Date(0, 0, 1, 4, 30, 0);
            const end = new Date(0, 0, 1, 21, 30, 0);
            const percent = calculate(start, end, new Date());
            document.getElementById("countup").innerHTML = `${percent[0].toFixed(2)}%`;
            document.getElementById("countdown").innerHTML = `${percent[1].toFixed(2)}%`;
        }

        window.onload = function () {
            tokeiLoop();
            setInterval(tokeiLoop, 500);
        }

        function calculate(start, end, now_time) {
            let startIsBiggerThanEnd = false;
            let sleepTime = false;
            const nowSecAll = now_time.getUTCHours() * 3600 + now_time.getUTCMinutes() * 60 + now_time.getUTCSeconds();
            let startSec = start.getUTCHours() * 3600 + start.getUTCMinutes() * 60 + start.getUTCSeconds();
            let endSec = end.getUTCHours() * 3600 + end.getUTCMinutes() * 60 + end.getUTCSeconds();
            let percent = 0;
            if (startSec > endSec) {
                startSec -= 86400;
                startIsBiggerThanEnd = true;
            }
            const activable = endSec - startSec;
            let activeNowSec = nowSecAll - startSec;
            if (startIsBiggerThanEnd) {
                if (nowSecAll >= endSec || (nowSecAll - 86400) <= startSec) {
                    sleepTime = true;
                }
            } else {
                if (nowSecAll >= endSec || nowSecAll <= startSec) {
                    sleepTime = true;
                }
            }
            if (sleepTime) {
                const sleepingStart = endSec;
                const sleepingEnd = startSec + 86400;
                const sleepingDuration = sleepingEnd - sleepingStart;
                activeNowSec = nowSecAll - sleepingStart;
                if (activeNowSec < 0) {
                    activeNowSec += 86400;
                }
                percent = -(activeNowSec / sleepingDuration) * 100;
            } else {
                percent = activeNowSec / activable * 100;
            }
            if (percent < 0) {
                return [percent, (-100) - percent];
            } else {
                return [percent, 100 - percent];
            }
        }


    </script>
</body>

</html>